---
title: "characterization Spleen data"
author: "Mechthild LÃ¼tge"
date: "16 June 2020"
output:
  html_document:
    self_contained: no
    code_folding: show
    number_sections: no
    toc: yes
    toc_depth: 3
    toc_float: true
    collapsed: no
    smooth_scroll: yes
---

```{r setup, include=FALSE}
options(width = 100)
knitr::opts_chunk$set(warning = FALSE, message = FALSE, dev = c("png", "pdf"))
seed <- 1234
```

## load packages
```{r libs}
suppressPackageStartupMessages({
  library(tidyverse)
  library(Seurat)
  library(magrittr)
  library(dplyr)
  library(purrr)
  library(ggplot2)
  library(here)
  library(runSeurat3)
  library(SingleCellExperiment)
  library(RColorBrewer)
  library(viridis)
  library(ggsci)
  library(scater)
  library(scran)
  library(pheatmap)
  library(CellMixS)
  library(muscat)
  library(edgeR)
  library(rcartocolor)
  library(harmony)
})

```


## set dir and read input data
```{r set dir}
basedir <- here()
sce <- readRDS(paste0(basedir, "/data/allSamplesMerged_plusDR_sce.rds"))
sce <- sce[,sce$SLO =="Spleen"]
```


## set color Vectors
```{r color vectors}

colorSLO <- c(viridis(3)[c(1,2)], brewer.pal(n=9, name="YlOrRd")[c(4)])
colorCond <- brewer.pal(n=3, name="Paired")[c(1,2)]
colorSLOCond <- c("#440154FF","#807DBA", "#FEB24C", "#F16913", "#21908CFF")
colorBatch <- pal_igv()(n=length(unique(sce$batch)))

# set colorPal names
names(colorSLO) <- c("LN", "PP", "Spleen")
names(colorCond) <- c("naive", "immunized")
names(colorBatch) <- unique(sce$batch)
names(colorSLOCond) <- c("LN_immunized","LN_naive", "Spleen_naive",
                         "Spleen_immunized", "PP_immunized")


colPal2 <- c(rcartocolor::carto_pal(name="Safe"), pal_futurama()(8))

## Spleen specific colPal
## final color palette
colPal3 <- c("#87c5af", "#94033b", "#fc8f3b", "#2580fe", "#514e72", "#007961",
            "#f4d403", "#38b5fc", "#eb6382", "#8fa38c", "#4673b4", "#b94403",
            "#b7d165", "#9b5662", "#666b73", "#075c62")
names(colPal3) <- c("LZFDC", "MRC", "TBRC","DZFDC","PRC2","RPF", "muralCells", 
                   "PRC1", "BCRC", "medRC1","IFRC", "Cxcl9TBRC", "capsular",
                   "LPFRC", "subepithelial", "aFDC")


## final color palette
colPal <- c("#87c5af", "#94033b", "#fc8f3b", "#2580fe", "#514e72", "#007961",
            "#f4d403", "#38b5fc", "#eb6382", "#8fa38c", "#4673b4", "#b94403",
            "#b7d165", "#9b5662", "#666b73")
names(colPal) <- c("LZFDC", "MRC", "TBRC","DZFDC","PRC2","RPF", "muralCells", 
                   "PRC1", "BCRC", "medRC","IFRC", "Cxcl9TBRC", "capsular",
                   "LPFRC", "subepithelial")

```

## run seurat pipeline
```{r run seurat}
seurat <- as.Seurat(sce)
dim(seurat)

seurat <- subset(seurat, subset = ENSMUSG00000023078.Cxcl13 >0)
seurat <- rerunSeurat3(seurat)
dim(seurat)

```

## visualize data {.tabset}

### clustering
```{r clustering}

DimPlot(seurat, reduction = "umap", cols=colPal2)+
  theme_bw() +
  theme(axis.text = element_blank(), axis.ticks = element_blank(), 
        panel.grid.minor = element_blank()) +
  xlab("UMAP1") +
  ylab("UMAP2")

```

### Batch
```{r Batch}

DimPlot(seurat, reduction = "umap", cols=colorBatch, group.by = "batch")+
  theme_bw() +
  theme(axis.text = element_blank(), axis.ticks = element_blank(), 
        panel.grid.minor = element_blank()) +
  xlab("UMAP1") +
  ylab("UMAP2")

```

### Cond
```{r Side}

DimPlot(seurat, reduction = "umap", cols=colorCond, group.by = "cond")+
  theme_bw() +
  theme(axis.text = element_blank(), axis.ticks = element_blank(), 
        panel.grid.minor = element_blank()) +
  xlab("UMAP1") +
  ylab("UMAP2")

```

## vis QC {.tabset}
### total features
```{r vis QC total features}

FeaturePlot(seurat, reduction = "umap",  features = "total_features_by_counts",
            cols = c("lightgrey", "darkred")) +
  theme_bw() +
  theme(axis.text = element_blank(), axis.ticks = element_blank(), 
        panel.grid.minor = element_blank()) +
  xlab("UMAP1") +
  ylab("UMAP2")

```

### total counts
```{r vis QC total counts}

FeaturePlot(seurat, reduction = "umap",  features = "total_counts",
            cols = c("lightgrey", "darkred")) +
  theme_bw() +
  theme(axis.text = element_blank(), axis.ticks = element_blank(), 
        panel.grid.minor = element_blank()) +
  xlab("UMAP1") +
  ylab("UMAP2")
```

### percentage mt counts
```{r vis QC percentage mt counts}

FeaturePlot(seurat, reduction = "umap",  features = "pct_counts_Mt",
            cols = c("lightgrey", "darkred")) +
  theme_bw() +
  theme(axis.text = element_blank(), axis.ticks = element_blank(), 
        panel.grid.minor = element_blank()) +
  xlab("UMAP1") +
  ylab("UMAP2")


```


## Find marker

```{r marker list seurat all}
Idents(seurat) <- seurat$originalexp_snn_res.0.25
seurat_markers_all <- FindAllMarkers(object = seurat,
                                     only.pos = TRUE, min.pct = 0.25,
                                     logfc.threshold = 0.25,
                                     test.use = "wilcox")

write.table(seurat_markers_all,
            file=paste0(basedir, "/data/Spleen_marker_SeuratClust.txt"),
            row.names = FALSE, col.names = TRUE, quote = FALSE, sep = "\t")


saveRDS(seurat, file=paste0(basedir, "/data/Spleen_seurat.rds"))

### res 0.25
## cluster 0,5,10: red pulb fibroblasts (Eng, Ly6a, Cxcl12)
## cluster 11: bridging TBRC/MRC (Ccl21a, Ccl19, Tnfsf11)
## cluster 2, 12: mural cells (Cnn1, Rgs5, Mcam, Pdgfrb)
## cluster 5: adventitial cells (Wt1, Il33, Cd34)
## cluster 3: FDC (Cr2, Fcamr, Fcgr2b, Sox9)
## cluster 7: intPRC (Madcam1. Il33, Cxcl13)
## cluster 9: PRC (Ly6a, Tlx1, Wt1)
## cluster 8: capsular fibroblasts (Lum, Cd34)
## cluster 1: TBRC (Ccl19, Ccl21a) 
## cluster 6: aFDC (Cr2, Fcamr, Fcgr2b, Sox9)


### res 0.4:
## cluster 0,3, 12: red pulb fibroblasts (Eng, Ly6a, Cxcl12)
## cluster 5: adventitial cells (Wt1, Il33, Cd34)
## cluster 2: TRC/TBRC (Ccl21a, Ccl19, Grem1)
## cluster 1,7,12: TNC1 (mural cells) (Mcam, Cnn1, Cspg4)
## cluster 4, 9: FDC (Cr2, Mfge8, Fcgr2b)
## cluster : MRC (Madcam1. Il33, Cxcl13)
## cluster 6: capsular fibroblasts (Lum, Cd34)
## cluster : PRCs/mural cells (?) 
## cluster : (Srgn, Bst1, Crym, Mfge8, Ccl21a) 

```

## expression of Xist {.tabset}
### all
```{r Xist expression all}

FeaturePlot(seurat, reduction = "umap",  features = "ENSMUSG00000086503.Xist",
            cols = c("lightgrey", "darkred")) +
  theme_bw() +
  theme(axis.text = element_blank(), axis.ticks = element_blank(), 
        panel.grid.minor = element_blank()) +
  xlab("UMAP1") +
  ylab("UMAP2")


```

### batch X
```{r Xist expression BX}
seuratS <- subset(seurat, batch=="BX")
FeaturePlot(seuratS, reduction = "umap",  features = "ENSMUSG00000086503.Xist",
            cols = c("lightgrey", "darkred")) +
  theme_bw() +
  theme(axis.text = element_blank(), axis.ticks = element_blank(), 
        panel.grid.minor = element_blank()) +
  xlab("UMAP1") +
  ylab("UMAP2")


```

### batch Y
```{r Xist expression BY}
seuratS <- subset(seurat, batch=="BY")
FeaturePlot(seuratS, reduction = "umap",  features = "ENSMUSG00000086503.Xist",
            cols = c("lightgrey", "darkred")) +
  theme_bw() +
  theme(axis.text = element_blank(), axis.ticks = element_blank(), 
        panel.grid.minor = element_blank()) +
  xlab("UMAP1") +
  ylab("UMAP2")


```

### batch Z
```{r Xist expression BZ}
seuratS <- subset(seurat, batch=="BZ")
FeaturePlot(seuratS, reduction = "umap",  features = "ENSMUSG00000086503.Xist",
            cols = c("lightgrey", "darkred")) +
  theme_bw() +
  theme(axis.text = element_blank(), axis.ticks = element_blank(), 
        panel.grid.minor = element_blank()) +
  xlab("UMAP1") +
  ylab("UMAP2")

```

### batch W
```{r Xist expression BW}
seuratS <- subset(seurat, batch=="BW")
FeaturePlot(seuratS, reduction = "umap",  features = "ENSMUSG00000086503.Xist",
            cols = c("lightgrey", "darkred")) +
  theme_bw() +
  theme(axis.text = element_blank(), axis.ticks = element_blank(), 
        panel.grid.minor = element_blank()) +
  xlab("UMAP1") +
  ylab("UMAP2")

remove(seuratS)
```


## re-embedding FDCs/MRCs/TBRCs
```{r re-embedding}
seuratSub <- subset(seurat, idents=c("3", "1"))

seuratSub <- rerunSeurat3(seuratSub, res = c(0.4, 0.8, 0.25, 0.6))
seurat_markers_sub <- FindAllMarkers(object = seuratSub,
                                     only.pos = TRUE, min.pct = 0.25,
                                     logfc.threshold = 0.25,
                                     test.use = "wilcox")


## res 0.6
## cluster 1 + 5 + 4 = TBRC (Ccl21a, Ccl19, Fmod, Prelp, Cxcl13 gradient)
## cluster 2 = LZFDC (Cr2, Fcamr, Fcer2a)
## cluster 3 = DZFDC
## cluster 0 = MRC (Tnfsf11, Madcam1)
## cluster 6 = mural


```


## assign labels

```{r assign label}

## cluster 0,9: red pulb fibroblasts (Eng, Ly6a, Cxcl12, Kazald1)
  ## cluster : bridging TBRC/MRC (Ccl21a, Ccl19, Tnfsf11)
## cluster 2, 5, 8, 11: mural cells/pericytes (Cnn1, Rgs5, Mcam, Pdgfrb, Myh11)
## cluster 5: half Thy1 TRC (Cst3, Gsn, Mfap4, Thy1, Dpt, Ccl11, Ccl19, Ccl21a)
## cluster 11: "pericytes2" (Lyz1, Mcam, Cpxm2, Nog) 
## cluster 4: adventitial cells/mesothelial (Wt1, Krt19, Lgals7, Cd34, no Ly6c1 or Pi16)
## cluster 3: FDC (Cr2, Fcamr, Fcgr2b, Sox9)
  ## cluster 7: intPRC (Madcam1. Il33, Cxcl13)
  ## cluster 9: PRC (Ly6a, Tlx1, Wt1)
## cluster 7: capsular fibroblasts (Lum, Cd34) (also Pi16 and Ly6c1!)
## cluster 1: TBRC/MRC (Ccl19, Ccl21a) 
## cluster 6: aFDC (Cr2, Fcamr, Fcgr2b, Sox9, Atp5e)
## cluster 10: BCRC(?) (Bst1, Clic5, Ccl21a, Kazald1) (markers from both RPRC + TBRCs)


## label cells
seurat$clusterLabel <- "muralCells"
seurat$clusterLabel[which(seurat$originalexp_snn_res.0.25 %in%
                            c("0", "9"))] <- "RPF"
seurat$clusterLabel[which(seurat$originalexp_snn_res.0.25 == "10")] <- "BCRC"
seurat$clusterLabel[which(seurat$originalexp_snn_res.0.25 == "4")] <- "capsular"
seurat$clusterLabel[which(seurat$originalexp_snn_res.0.25 == "7")] <- "PRC2"
seurat$clusterLabel[which(seurat$originalexp_snn_res.0.25 == "6")] <- "aFDC"

### label from re-embedding
fdc <- colnames(seuratSub)[which(seuratSub$originalexp_snn_res.0.8 %in%
                                   c("2", "3", "7", "8", "10"))]
mrc <- colnames(seuratSub)[which(seuratSub$originalexp_snn_res.0.8 == "5")]
tbrc <- colnames(seuratSub)[which(seuratSub$originalexp_snn_res.0.8 %in%
                                    c("0", "1", "6", "9"))]
dzfdc <- colnames(seuratSub)[which(seuratSub$originalexp_snn_res.0.8 == "4")]

seurat$clusterLabel[which(colnames(seurat) %in% fdc)] <- "LZFDC"
seurat$clusterLabel[which(colnames(seurat) %in% mrc)] <- "MRC"
seurat$clusterLabel[which(colnames(seurat) %in% tbrc)] <- "TBRC"
seurat$clusterLabel[which(colnames(seurat) %in% dzfdc)] <- "DZFDC"


Idents(seurat) <- seurat$clusterLabel
```

Note 1: BCRC express both, markers from RPRC and TBRCs (e.g. Bst1, Ccl19 (WP marker)  
as well as Clic5, Kazald1 (RP marker))  
Note 2: mural cells comprise multiple cluster that are assigned as pericytes in  
the Scott Mueller paper and intPRCs plus TNC1 in HW paper  
Note 3: Some cells of one mural cell cluster express marker similar to the Thy1 TRC  
cluster from the Scott Mueller study  
Note 4: The adventitial cell cluster includes mesothelial cells (Krt19, Lgals7) and  
shows no expression of Ly6c1 and Pi16  
Note 5: capsular fibroblasts contain "universal Fibroblast" cluster (Cd34, Dpt, Pi16 and Ly6c1)  


## vis cluster label
```{r vis cl lab}

DimPlot(seurat, reduction = "umap", cols=colPal3)+
  theme_bw() +
  theme(axis.text = element_blank(), axis.ticks = element_blank(), 
        panel.grid.minor = element_blank()) +
  xlab("UMAP1") +
  ylab("UMAP2")

DimPlot(seurat, reduction = "umap", cols=colPal3, shuffle=T,pt.size=0.6)+
  theme_void()

```


## vis cluster characterization {.tabset}

```{r avg heatmap funct}
avgHeatmap <- function(seurat, selGenes, colVecIdent, colVecCond=NULL,
                       ordVec=NULL, gapVecR=NULL, gapVecC=NULL,cc=FALSE,
                       cr=FALSE, condCol=FALSE){
  
  selGenes <- selGenes$gene
  
  ## assay data
  clusterAssigned <- as.data.frame(Idents(seurat)) %>%
  dplyr::mutate(cell=rownames(.))
  colnames(clusterAssigned)[1] <- "ident"
  seuratDat <- GetAssayData(seurat)
  
  ## genes of interest
  genes <- data.frame(gene=rownames(seurat)) %>% 
    mutate(geneID=gsub("^.*\\.", "", gene)) %>% filter(geneID %in% selGenes)

  ## matrix with averaged cnts per ident
  logNormExpres <- as.data.frame(t(as.matrix(
    seuratDat[which(rownames(seuratDat) %in% genes$gene),])))
  logNormExpres <- logNormExpres %>% dplyr::mutate(cell=rownames(.)) %>%
    dplyr::left_join(.,clusterAssigned, by=c("cell")) %>%
    dplyr::select(-cell) %>% dplyr::group_by(ident) %>%
    dplyr::summarise_all(mean)
  logNormExpresMa <- logNormExpres %>% dplyr::select(-ident) %>% as.matrix()
  rownames(logNormExpresMa) <- logNormExpres$ident
  logNormExpresMa <- t(logNormExpresMa)
  rownames(logNormExpresMa) <- gsub("^.*?\\.","",rownames(logNormExpresMa))
  
  ## remove genes if they are all the same in all groups
  ind <- apply(logNormExpresMa, 1, sd) == 0
  logNormExpresMa <- logNormExpresMa[!ind,]
  genes <- genes[!ind,]

  ## color columns according to cluster
  annotation_col <- as.data.frame(gsub("(^.*?_)","",
                                       colnames(logNormExpresMa)))%>%
    dplyr::mutate(celltype=gsub("(_.*$)","",colnames(logNormExpresMa)))
  colnames(annotation_col)[1] <- "col1"
  annotation_col <- annotation_col %>%
    dplyr::mutate(cond = gsub("(^[0-9]_?)","",col1)) %>%
    dplyr::select(cond, celltype)
  rownames(annotation_col) <- colnames(logNormExpresMa) 

  ann_colors = list(
      cond = colVecCond,
      celltype=colVecIdent)
  if(is.null(ann_colors$cond)){
    annotation_col$cond <- NULL
  }
  
  ## adjust order
  logNormExpresMa <- logNormExpresMa[selGenes,]
  if(is.null(ordVec)){
    ordVec <- levels(seurat)
  }
  logNormExpresMa <- logNormExpresMa[,ordVec]

  ## scaled row-wise
  pheatmap(logNormExpresMa, scale="row" ,treeheight_row = 0, cluster_rows = cr, 
         cluster_cols = cc,
         color = colorRampPalette(c("#45628f", "#F7F7F7", "#de425b"))(50),
         annotation_col = annotation_col, cellwidth=15, cellheight=10,
         annotation_colors = ann_colors, gaps_row = gapVecR, gaps_col = gapVecC)
}

```


```{r marker cluster characterization}


## cluster 0 = TBRC (Ccl21a, Ccl19, Fmod)
## cluster 1 = MRC (Tnfsf11, Madcam1)
## cluster 2 = FDC (Cr2, Fcamr, Fcer2a)
## cluster 3 = FDC (Cox4i1, Atp5e)
## cluster 4 = bTBRC (Ccl21a, Ccl19, Wt1 ,Cyp4b1, Bst1)


selMarker <- list(FDC = c("Xist","Sox9", "Fcer2a", "Cr2", "Fcamr"),
                  aFDC = c("Cox4i1","Atp5e"),
                  MRC = c("Tnfsf11", "Hamp2", "Madcam1", "Cxcl13"),
                  TBRC = c("Bst1", "Glycam1", "Fmod","Ccl21a","Ccl19","Ifitm1"),
                  DZFDC = c("Pdlim3", "Crym", "Emp2", "Ecm1", "Trf", "Il6",
                            "Cxcl1", "Cxcl16", "Ptgs2", "Gstp1", "Cd151", 
                            "Clec14a", "Plat", "Ptn", "Mmp3"),
                  PRC = c("Pdgfrb", "Tlx1", "Eng", "Cxcl12", "Ly6a", "Wt1"),
                  mural = c("Rgs5", "Cnn1", "Acta2", "Mcam"),
                  adventitial = c("Cd34","Igfbp6", "Lum")
                  )


selMarker <- list(FDC = c("Fcgr2b", "Cr2","Sox9"),
                  aFDC = c("Cox4i1","Atp5e"),
                  MRC = c("Cxcl13", "Madcam1", "Tnfsf11"),                  
                  DZFDC = c("Pdlim3", "Crym", "Cxcl12"),
                  TBRC = c("Ccl21a","Ccl19", "Fmod"),
                  RPF = c("Pdgfrb", "Eng", "Ly6a"),
                  mural = c("Cnn1", "Cspg4", "Mcam"),
                  capsular = c("Krt19", "Upk3b"),
                  adventitial = c("Cd34","Pi16")
                  )

```


### avg heatmap
```{r avg heatmap cl marker, fig.height=8, fig.width=6}

selGenes <- data.frame(gene=unlist(selMarker)) %>%
  rownames_to_column(var="grp") %>% mutate(Grp=gsub(".{1}$", "", grp))
grpCnt <- selGenes %>% group_by(Grp) %>% summarise(cnt=n())
gapR <- data.frame(Grp=unique(selGenes$Grp)) %>% 
  left_join(.,grpCnt, by="Grp") %>% mutate(cumSum=cumsum(cnt)) 
ordVec <- levels(seurat)[c(1, 9, 6, 4, 3, 10, 2, 8, 5,7)]

pOut <- avgHeatmap(seurat = seurat, selGenes = selGenes,
                  colVecIdent = colPal3, 
                  ordVec=ordVec,
                  gapVecR=gapR$cumSum, gapVecC=NULL,cc=F,
                  cr=F, condCol=F)

```
##save seurat 
```{r save seurat}
Idents(seurat) <- seurat$clusterLabel
saveRDS(seurat, file=paste0(basedir, "/data/Spleen_seurat.rds"))

```



## vis cluster label wo aFDCs
```{r vis cl lab merged}

seurat <- subset(seurat, clusterLabel != "aFDC")
seurat <- ScaleData(object = seurat, verbose = FALSE,
                        features = rownames(seurat))
seurat <- RunPCA(object = seurat, npcs = 20, verbose = FALSE)
seurat <- RunTSNE(object = seurat, reduction = "pca", dims = 1:20)
seurat <- RunUMAP(object = seurat, reduction = "pca", dims = 1:20)

Idents(seurat) <- seurat$clusterLabel

DimPlot(seurat, reduction = "umap", cols=colPal, shuffle=T)+
  theme_bw() +
  theme(axis.text = element_blank(), axis.ticks = element_blank(), 
        panel.grid.minor = element_blank()) +
  xlab("UMAP1") +
  ylab("UMAP2")

DimPlot(seurat, reduction = "umap", cols=colPal, shuffle=T,pt.size=0.6)+
  theme_void()
```


### avg heatmap
```{r avg heatmap cl marker merged, fig.height=8, fig.width=6}

selMarker <- list(FDC = c("Fcgr2b", "Cr2","Sox9"),
#                  aFDC = c("Cox4i1","Atp5e"),
                  DZFDC = c("Pdlim3", "Crym", "Cxcl12"),
                  MRC = c("Cxcl13", "Madcam1", "Tnfsf11"),                  
                  TBRC = c("Ccl21a","Ccl19", "Fmod"),
                  RPF = c("Pdgfrb", "Eng", "Ly6a"),
                  mural = c("Cnn1", "Cspg4", "Mcam"),
                  capsular = c("Krt19", "Upk3b"),
                  adventitial = c("Cd34","Pi16")
                  )

selGenes <- data.frame(gene=unlist(selMarker)) %>%
  rownames_to_column(var="grp") %>% mutate(Grp=gsub(".{1}$", "", grp))
grpCnt <- selGenes %>% group_by(Grp) %>% summarise(cnt=n())
gapR <- data.frame(Grp=unique(selGenes$Grp)) %>% 
  left_join(.,grpCnt, by="Grp") %>% mutate(cumSum=cumsum(cnt)) 
ordVec <- levels(seurat)[c(5,3,8,2,9,1,7,4,6)]

pOut <- avgHeatmap(seurat = seurat, selGenes = selGenes,
                  colVecIdent = colPal, 
                  ordVec=ordVec,
                  gapVecR=gapR$cumSum, gapVecC=NULL,cc=F,
                  cr=F, condCol=F)
```


## compare to all eyfp data
```{r comp all eyfp}

seuratEYFP <- readRDS(paste0("/Users/mechthildluetge/Projects/scRNAseq/",
                             "CrossSLO_BCR/data/Spleen_seurat.rds"))
seuratEYFPdat <- data.frame(labelOld=seuratEYFP$clusterLabel) %>%
  rownames_to_column(var="cellname")

seuratdat <- data.frame(labelNew=seurat$clusterLabel) %>%
  rownames_to_column(var="cellname") %>%
  left_join(., seuratEYFPdat, by="cellname")

table(seuratdat$labelNew, seuratdat$labelOld)
seurat$labelOld <- seuratdat$labelOld
table(seurat$labelOld)
table(seurat$clusterLabel)


DimPlot(seurat, reduction = "umap", cols=colPal, group.by="labelOld")+
  theme_bw() +
  theme(axis.text = element_blank(), axis.ticks = element_blank(), 
        panel.grid.minor = element_blank()) +
  xlab("UMAP1") +
  ylab("UMAP2")

```


##save seurat wo aFDC
```{r save seurat wo aFDC}
Idents(seurat) <- seurat$clusterLabel
saveRDS(seurat, file=paste0(basedir, "/data/Spleen_wo_aFDC_seurat.rds"))

```


## session info
```{r session info}
sessionInfo()
date()
```


